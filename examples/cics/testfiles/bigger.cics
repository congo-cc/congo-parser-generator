EXEC CICS HANDLE ABEND 
LABEL(ABEND-ROUTINE) 
END-EXEC

EXEC CICS 
SYNCPOINT 
END-EXEC

EXEC CICS XCTL 
PROGRAM (CDEMO-TO-PROGRAM) 
COMMAREA(CARDDEMO-COMMAREA) 
END-EXEC

EXEC CICS RETURN 
TRANSID (LIT-THISTRANID) 
COMMAREA (WS-COMMAREA) 
LENGTH(LENGTH OF WS-COMMAREA) 
END-EXEC

EXEC CICS RECEIVE MAP(LIT-THISMAP) 
MAPSET(LIT-THISMAPSET) 
INTO(CACTUPAI) 
RESP(WS-RESP-CD) 
RESP2(WS-REAS-CD) 
END-EXEC

EXEC CICS SEND MAP(CCARD-NEXT-MAP) 
MAPSET(CCARD-NEXT-MAPSET) 
FROM(CACTUPAO) 
CURSOR 
ERASE 
FREEKB 
RESP(WS-RESP-CD) 
END-EXEC

EXEC CICS READ 
DATASET (LIT-CARDXREFNAME-ACCT-PATH) 
RIDFLD (WS-CARD-RID-ACCT-ID-X) 
KEYLENGTH (LENGTH OF WS-CARD-RID-ACCT-ID-X) 
INTO (CARD-XREF-RECORD) 
LENGTH (LENGTH OF CARD-XREF-RECORD) 
RESP (WS-RESP-CD) 
RESP2 (WS-REAS-CD) 
END-EXEC

EXEC CICS READ 
DATASET (LIT-ACCTFILENAME) 
RIDFLD (WS-CARD-RID-ACCT-ID-X) 
KEYLENGTH (LENGTH OF WS-CARD-RID-ACCT-ID-X) 
INTO (ACCOUNT-RECORD) 
LENGTH (LENGTH OF ACCOUNT-RECORD) 
RESP (WS-RESP-CD) 
RESP2 (WS-REAS-CD) 
END-EXEC

EXEC CICS READ 
DATASET (LIT-CUSTFILENAME) 
RIDFLD (WS-CARD-RID-CUST-ID-X) 
KEYLENGTH (LENGTH OF WS-CARD-RID-CUST-ID-X) 
INTO (CUSTOMER-RECORD) 
LENGTH (LENGTH OF CUSTOMER-RECORD) 
RESP (WS-RESP-CD) 
RESP2 (WS-REAS-CD) 
END-EXEC

EXEC CICS READ 
FILE (LIT-ACCTFILENAME) 
UPDATE 
RIDFLD (WS-CARD-RID-ACCT-ID-X) 
KEYLENGTH (LENGTH OF WS-CARD-RID-ACCT-ID-X) 
INTO (ACCOUNT-RECORD) 
LENGTH (LENGTH OF ACCOUNT-RECORD) 
RESP (WS-RESP-CD) 
RESP2 (WS-REAS-CD) 
END-EXEC

EXEC CICS READ 
FILE (LIT-CUSTFILENAME) 
UPDATE 
RIDFLD (WS-CARD-RID-CUST-ID-X) 
KEYLENGTH (LENGTH OF WS-CARD-RID-CUST-ID-X) 
INTO (CUSTOMER-RECORD) 
LENGTH (LENGTH OF CUSTOMER-RECORD) 
RESP (WS-RESP-CD) 
RESP2 (WS-REAS-CD) 
END-EXEC

EXEC CICS 
REWRITE FILE(LIT-ACCTFILENAME) 
FROM(ACCT-UPDATE-RECORD) 
LENGTH(LENGTH OF ACCT-UPDATE-RECORD) 
RESP (WS-RESP-CD) 
RESP2 (WS-REAS-CD) 
END-EXEC

EXEC CICS 
REWRITE FILE(LIT-CUSTFILENAME) 
FROM(CUST-UPDATE-RECORD) 
LENGTH(LENGTH OF CUST-UPDATE-RECORD) 
RESP (WS-RESP-CD) 
RESP2 (WS-REAS-CD) 
END-EXEC

EXEC CICS 
SYNCPOINT ROLLBACK 
END-EXEC

EXEC CICS SEND 
FROM (ABEND-DATA) 
LENGTH(LENGTH OF ABEND-DATA) 
NOHANDLE 
ERASE 
END-EXEC

EXEC CICS HANDLE ABEND 
CANCEL 
END-EXEC

EXEC CICS ABEND 
ABCODE('9999') 
NOHANDLE
END-EXEC
